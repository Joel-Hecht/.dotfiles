#!/bin/bash

subdirs=""
depth=0
execute_loop=true

# help
if [[ $# -eq 0 || $1 == "-help" || $1 == "--help" ]]; then
	echo "breadth first recursive cd, enters hidden directories"
	echo "syntax: bfsh dirname [maxdepth (default=5)]"
	execute_loop=false
fi

# default maxdepth
if [[ $# -gt 1 ]]; then
	maxdepth=$2
	if ! [[ "$maxdepth" =~ ^[0-9]+$ ]]; then
		echo "maxdepth (arg 2) must be a number"
		execute_loop=false
	fi
else
	maxdepth=5
fi

# check if target is in pwd
cd "$1" &> /dev/null && execute_loop=false

# main loop
while [[ $execute_loop == "true" ]]; do
	subdirs+="?(.)*/"
	depth=$(( $depth + 1))

	# check for termination
	[[ $depth -le $maxdepth ]] || echo "hit maxdepth ($maxdepth)!"
	[[ $depth -le $maxdepth ]] || break
	ls -d $subdirs &> /dev/null || echo "no more subdirectories at depth=$depth"
	ls -d $subdirs &> /dev/null || break

	# look for directory
	matched_dir=$( ls -d $subdirs | grep "/$1/" )
	if [[ -n "$matched_dir" ]]; then
		# if multiple matched dirs (get better names bro), just go to first
		cd "$( echo "$matched_dir" | head -n 1)"
		break
	fi
done
